# 🤖 Google-Gemini Telegram Bot

![Python](https://img.shields.io/badge/Python-3.10%2B-3776AB?style=for-the-badge&logo=python&logoColor=white)
![Gemini](https://img.shields.io/badge/Google%20AI-Gemini-8E75B2?style=for-the-badge&logo=google&logoColor=white)
![Telegram](https://img.shields.io/badge/Telegram-Bot-2CA5E0?style=for-the-badge&logo=telegram&logoColor=white)

Telegram бот для общения с Gemini, написанный на Python с использованием Antigravity IDE (Google).
Поддерживает мультимодальное общение с нейросетью (текст, фото, аудио), генерацию изображений, поиск в интернете, первод текста и фото, саммари видео, инлайн режим.<br>
От вас требуется API Gemini, и сервер на котором бот будет работать. Все это рассписано подробно в моем гайде: https://t.me/ChoronoNotes/107

---

## 1. ✨ Ключевые Возможности Бота

| Иконка | Функция             | Описание                                                                    |
| :---: |:--------------------|:----------------------------------------------------------------------------|
| 💬 | **Умный диалог**    | Просто напиште боту что хотите, он ответит.<br/> Контекст беседы 5 минут 💬 |
| 🖼️ | **Ви́дение (Vision)** | Понимает или описывает отправленные фото 📸                                 |
| 🎨 | **Генерация**       | Создает изображения по текстовому описанию ✍️                               |
| 🖌️ | **Редактирование**  | Изменяет фото по инструкции пользователя 🧰                                 |
| 🌐 | **Grounding**       | Автоматически подключает Google Поиск 🔍                                    |
| 📄 | **Документы**       | Анализирует PDF, TXT, CSV, JSON файлы 📚                                    |
| 🎙️ | **Голос**           | Распознает голосовые сообщения и отвечает на них 🎧                         |
| 📺 | **YouTube Саммари** | Делает краткое содержание видео по ссылке ⏬                                 |
| 🔍 | **Инлайн-режим**    | `@bot_username вопрос?` в любом чате 💬                                     |

---

## 2. 🕹 Управление и Команды



### 🔥 Специальные Префиксы

Напишите букву или слово, чтобы переключать режимы в боте:

#### 🧠 Переключение текстовой модели

| Префикс | Описание | Пример |
| :--- | :--- | :--- |
| **П** / **Про** | 💎 Переключает на **Gemini Pro** (умнее, глубже) | `п` или `про` |
| **Ф** / **Флеш** | ⚡ Переключает на **Gemini Flash** (быстрее) | `ф` или `флеш` |

#### 🎨 Генерация и редактирование изображений

| Префикс | Описание | Пример |
| :--- | :--- | :--- |
| **К** / **Картинка** | 🖼️ Создаёт картинку по описанию | `К рыжий кот в космосе` |
| **К про** | 💎 Переключает генерацию картинок на Pro | `к про` |
| **К флеш** | ⚡ Переключает генерацию картинок на Flash | `к флеш` |
| **Р** / **Редактировать** | ✏️ Режим редактирования фото | `Р` → отправь фото |
| **Р** + текст | ✏️ Редактирует фото с инструкцией | `Р добавь очки` + фото |

#### 🛠 Другие режимы

| Префикс | Описание | Пример |
| :--- | :--- | :--- |
| **Пр** / **Перевод** | 🌐 Переводит текст на русский; фото — перевод на изображении | `Пр How are you?` |
| **Ю** / **Ютуб** | 📺 Саммари YouTube видео | `Ю https://youtu.be/...` |

#### 🔄 Сброс и выход

| Команда | Описание |
| :--- | :--- |
| **.** | 🧹 Мгновенный сброс контекста и режима |
| **выход** / **exit** | ⏹️ Выход из текущего режима |
| **/start** | 🔄 Полный сброс сессии |

### 2.2 🔍 Инлайн-режим

Используй бота **в любом чате** без перехода в диалог с ботом:

1. Набери `@имя_бота твой вопрос?` (закончи точкой `.` или `?`)
2. Появится результат с ответом Gemini
3. Нажми на результат — ответ отправится в чат

> **💡 Триггер:** Запрос к API происходит только когда текст заканчивается на `.` или `?`.  
> Это экономит API-вызовы и даёт время набрать весь вопрос.

> **⚠️ Важно:** Включи инлайн-режим в своем боте через @BotFather → `/setinline`

### 2.3 📸 Работа с Фото

**Перевод фото:**
- Включите режим **Пр/Перевод** и отправьте фото — бот попытается заменить текст прямо на изображении.
- Если не получилось, пришлет обычный текстовый перевод.


**При отправке фото без подписи** появляются инлайн-кнопки (⏱ таймаут 3 минуты):

1) 🔍 **Анализировать** — описывает содержимое изображения (модель зависит от 💎 Pro / ⚡ Flash)
2) ✏️ **Редактировать** — редактирует фото по вашему запросу (`gemini-3-pro-image-preview`, всегда Pro)

**Как это работает:**
1. Отправьте фото → появятся кнопки
2. Нажмите **Анализировать** → бот опишет изображение
3. **Контекст сохранён!** Теперь можно задавать вопросы об этом изображении текстом в течение 5 минут
4. Нажмите **Редактировать** → введите описание изменений → получите новое фото

### 2.4 📷 Работа с Альбомами (Несколько фото)

> Бот поддерживает отправку **нескольких изображений** одновременно (альбом).

**Способ 1: Альбом без подписи**
1. Отправьте **2-10 фото** альбомом (выберите несколько фото в Telegram)
2. Появится сообщение `📷 Получено N фото. Что сделать с альбомом?`
3. Нажмите **Редактировать** → введите промпт → Gemini увидит **все фото** и решит что делать

**Способ 2: Альбом с подписью (быстрее!)**
1. Отправьте **2-10 фото** альбомом **с подписью** `р/редактировать <инструкция>`
2. Бот сразу начнёт редактирование без кнопок

**Примеры подписей для альбома:**
1. `р/редактировать объедини эти фото` — объединение нескольких изображений
2. `р/редактировать возьми стиль с первого фото и примени ко второму` — перенос стиля
3. `р/редактировать сделай коллаж из этих фото` — создание коллажа

**🧠 Контекст изображения:**
> После анализа изображения (кнопка 🔍) бот **сохраняет картинку в памяти на 5 минут**.  
> В течение этого времени все текстовые вопросы будут обрабатываться с учётом изображения.  
> **Пример:** Отправили фото игры → нажали "Анализировать" → спросили "что это?" → бот ответит с учётом картинки! ✨


> **⚠️ Таймаут кнопок:** Если не нажать кнопку в течение 3 минут, данные фото удаляются автоматически.

### 2.5 🛠 Основные Команды

1. `/start` — 👋 **Начать** новый диалог и сбросить память.
2. `/help` — ℹ️ **Справка** по всем командам.
3. `/status` — 📊 **Статистика** бота и состояние.
4. `/models` — 🧠 **Список** всех доступных AI моделей.
5. `/youtube` — 📺 **YouTube** режим саммаризации видео.
6. `/id` — 🆔 **Узнать** свой Telegram ID.

### 2.6 ⚙️ Настройка Моделей

1. `/1model` — Включить **Gemini Pro** (💎 Умнее, но медленнее).
2. `/2model` — Включить **Gemini Flash** (⚡ Быстрее и экономнее).
3. `/imagepro` — Включить **Pro** для картинок + ждёт промпт.
4. `/imageflash` — Включить **Flash** для картинок + ждёт промпт.

### 2.7 🔐 Админ-команды (скрыты из меню)

1. `/add <ID>` — Добавить пользователя в белый список.
2. `/del <ID>` — Удалить пользователя из белого списка.
3. `/status` — Статистика бота (CPU, RAM, ошибки).

---

## 3. 🧠 Используемые Модели

### 3.1 Какой инструмент какую модель использует

| Инструмент | Модель | Переключается? | Где в коде |
| :--- | :--- | :---: | :--- |
| 💬 **Текстовый чат** | `gemini-3-pro-preview` / `gemini-flash-latest` | ✅ `/1model` `/2model` | строка 137-138 |
| 🎤 **Голосовые сообщения** | `gemini-flash-latest` (всегда Flash) | ❌ | строка 1494 |
| 🖼️ **Анализ фото** | Зависит от `/1model` `/2model` | ✅ | — |
| 🎨 **Генерация картинок** | `gemini-3-pro-image-preview` / `gemini-2.5-flash-image` | ✅ `/imagepro` `/imageflash` | строка 90-91 |
| ✏️ **Редактирование фото** | `gemini-3-pro-image-preview` / `gemini-2.5-flash-image` | ✅ `/1model` `/2model` | строка 664 |
| 📄 **Анализ документов** | Зависит от `/1model` `/2model` | ✅ | — |
| 🌐 **Перевод текста** | `gemini-flash-latest` (всегда Flash) | ❌ | строка 2373 |
| 🖼️ **Перевод текста на фото** | `gemini-3-pro-image-preview` / `gemini-2.5-flash-image` | ✅ `/imagepro` `/imageflash` | строка 1526 |
| 📺 **YouTube саммари** | `gemini-flash-latest` (всегда Flash) | ❌ | строка 855 |
| 🔍 **Инлайн-режим** | `gemini-flash-latest` + 🌐 поиск (всегда Flash) | ❌ | строка 2824 |

---

## 4. 🚀 Быстрый старт

1. Установи Python 3.10+.
2. Создай и активируй виртуальное окружение.
3. Установи зависимости.
4. Скопируй пример .env и заполни ключи.
5. Запусти бота.

```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r docs/requirements.txt
copy docs\env.example .env
python googlebot.py
```

## 5. ⚙️ Конфигурация (.env)

Обязательные:
- `TELEGRAM_TOKEN` — токен бота от @BotFather
- `GEMINI_API_KEY` — ключ Gemini API

Опциональные:
- `ADMIN_ID` — Telegram ID администратора (для админ-команд)
- `ALLOWED_USERS` — список ID через запятую (белый список)
- `LOG_TO_FILE` — `1`/`0` включить лог в `bot.log`
- `SAVE_ACTIVITY_LOG` — `1`/`0` лог активности в `activity_log.json`
- `LOG_RETENTION_DAYS` — хранить логи N дней
- `LOG_MAX_TOTAL_BYTES` — лимит суммарного размера логов (байты)

## 6. 📄 Логи и данные

- `bot.log` — основной лог (если `LOG_TO_FILE=1`)
- `activity_log.json` — активность пользователей (если `SAVE_ACTIVITY_LOG=1`)
- `allowed_users.json` — белый список (создается автоматически)

## 7. 🚀 Деплой (опционально)

Для деплоя на сервер:
1. Загрузите `googlebot.py` и `docs/requirements.txt` на сервер
2. Установите зависимости: `pip install -r requirements.txt`
3. Настройте `.env` с токенами
4. Запустите через `systemctl` или напрямую

## 8. 🧩 Структура проекта

Подробная схема файлов и архитектуры — в `PROJECT_STRUCTURE.md`.


