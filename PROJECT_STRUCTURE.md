# üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

> **–ë—ã—Å—Ç—Ä—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫** –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Google Gemini Telegram Bot 2.0

---

## üóÇ –§–∞–π–ª–æ–≤–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
bot/
‚îú‚îÄ‚îÄ googlebot.py       # üéØ –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –±–æ—Ç–∞ (~2412 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ README.md          # üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ PROJECT_STRUCTURE.md # üëà –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ requirements.txt   # üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
‚îú‚îÄ‚îÄ .env               # üîê –¢–æ–∫–µ–Ω—ã (BOT_TOKEN, GEMINI_API_KEY)
‚îú‚îÄ‚îÄ .gitignore         # üö´ –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã Git
‚îú‚îÄ‚îÄ bot.log            # üìã –õ–æ–≥–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
‚îú‚îÄ‚îÄ activity_log.json  # üìä –õ–æ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ allowed_users.json # üë• –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ deploy.ps1         # üöÄ –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ commit.ps1         # üì§ –°–∫—Ä–∏–ø—Ç –∫–æ–º–º–∏—Ç–∞ –≤ Git
```

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ `googlebot.py`

### üìç –†–∞–∑–¥–µ–ª—ã —Ñ–∞–π–ª–∞ (–ø–æ —Å—Ç—Ä–æ–∫–∞–º)

| `1-57` | **–ò–º–ø–æ—Ä—Ç—ã –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã** | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏, —Ç–∞–π–º-–∞—É—Ç—ã, –ª–∏–º–∏—Ç—ã –∞–ª—å–±–æ–º–æ–≤ |
| `58-133` | **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AI** | –°–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –º–æ–¥–µ–ª–∏, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è |
| `134-210` | **–ü–∞–º—è—Ç—å –±–æ—Ç–∞** | –°–µ—Å—Å–∏–∏, `pending_albums`, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `211-375` | **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –£—Ç–∏–ª–∏—Ç—ã** | –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –æ—à–∏–±–∫–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `376-731` | **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | `generate_image()`, `edit_image()`, YouTube |
| `732-1260` | **–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞** | `/start`, `/help`, `/status`, `/models` |
| `1261-1343` | **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–æ–ª–æ—Å–∞** | `handle_voice()` |
| `1344-1632` | **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ç–æ –∏ –∞–ª—å–±–æ–º–æ–≤** | `handle_photo()`, `process_album_delayed()` |
| `1633-1720` | **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** | `handle_document()` |
| `1721-2120` | **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π** | –¢–µ–∫—Å—Ç, –ø—Ä–µ—Ñ–∏–∫—Å—ã (–ü, –§, –ö, –ü—Ä, –†, –Æ), `handle_message()` |
| `2121-2200` | **Callback-–∏** | –ö–Ω–æ–ø–∫–∏ –ø–æ–¥ —Ñ–æ—Ç–æ (`button_callback()`) |
| `2201-2337` | **–ò–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º** | `handle_inline_query()` |
| `2338-2412` | **main()** | –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ |

---

## üîß –ö–ª—é—á–µ–≤—ã–µ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### üß† AI –ú–æ–¥–µ–ª–∏

```python
# –°—Ç—Ä–æ–∫–∏ 70-75: –ú–æ–¥–µ–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
IMAGE_MODELS = {
    'pro': 'gemini-3-pro-image-preview',
    'flash': 'gemini-2.5-flash-image'
}

# –°—Ç—Ä–æ–∫–∏ 87-111: –ú–æ–¥–µ–ª–∏ —á–∞—Ç–∞ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
MODELS = {
    'pro': 'gemini-3-pro-preview',
    'flash': 'gemini-flash-latest'
}
```

### üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –§—É–Ω–∫—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è                   | –°—Ç—Ä–æ–∫–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   |
|:--------------------------|:------:|:-----------------------------|
| `edit_image()`            |  590   | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ/–∞–ª—å–±–æ–º–æ–≤ |
| `handle_photo()`          |  1344  | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ –∏ –∞–ª—å–±–æ–º–æ–≤    |
| `process_album_delayed()` |  1551  | –°–±–æ—Ä–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–ª—å–±–æ–º–æ–≤  |
| `button_callback()`       |  2121  | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –ø–æ–¥ —Ñ–æ—Ç–æ    |

### üåê –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã AI (Grounding)

```python
# –°—Ç—Ä–æ–∫–∏ 67-69
SEARCH_TOOLS = [
    {"google_search": {}},  # –ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
    {"url_context": {}}     # –ê–Ω–∞–ª–∏–∑ URL
]
```

### ‚è± –¢–∞–π–º–∞—É—Ç—ã

| –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞               | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                           |
|:------------------------|:--------:|:-------------------------------------|
| `MEMORY_TIMEOUT`        |  5 –º–∏–Ω   | –°–±—Ä–æ—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–∞—Ç–∞                 |
| `TIMEOUT_SHORT`         |  60 —Å–µ–∫  | –ü–µ—Ä–µ–≤–æ–¥, YouTube —Å–∞–º–º–∞—Ä–∏             |
| `TIMEOUT_MEDIUM`        |  90 —Å–µ–∫  | Gemini —á–∞—Ç —Å –ø–æ–∏—Å–∫–æ–º                 |
| `TIMEOUT_LONG`          | 180 —Å–µ–∫  | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| `PHOTO_BUTTON_TIMEOUT`  |  3 –º–∏–Ω   | –ñ–∏–∑–Ω—å –∫–Ω–æ–ø–æ–∫ –ø–æ–¥ —Ñ–æ—Ç–æ                |
| `IMAGE_CONTEXT_TIMEOUT` |  5 –º–∏–Ω   | –ñ–∏–∑–Ω—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ        |
| `ALBUM_WAIT_TIME`       | 1.5 —Å–µ–∫  | –û–∂–∏–¥–∞–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ –∞–ª—å–±–æ–º–∞      |

---

## üìä –•—Ä–∞–Ω–µ–Ω–∏–µ –î–∞–Ω–Ω—ã—Ö

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è          | –¢–∏–ø    | –û–ø–∏—Å–∞–Ω–∏–µ                           |
|:--------------------|:-------|:-----------------------------------|
| `chat_sessions`     | `dict` | –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —á–∞—Ç–∞               |
| `last_activity`     | `dict` | –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏         |
| `user_models`       | `dict` | –ú–æ–¥–µ–ª—å —á–∞—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞      |
| `user_image_models` | `dict` | –ú–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞ |
| `allowed_users`     | `set`  | –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π         |
| `bot_stats`         | `dict` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Å–æ–æ–±—â–µ–Ω–∏—è, –æ—à–∏–±–∫–∏)     |
| `user_activity`     | `list` | –õ–æ–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏                     |

---

## üéõ –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ú–æ–¥–µ–ª–∏ (–ë—ã—Å—Ç—Ä–∞—è –°–ø—Ä–∞–≤–∫–∞)

| –§—É–Ω–∫—Ü–∏—è               | –ú–æ–¥–µ–ª—å          |       –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è?        |
|:----------------------|:----------------|:---------------------------:|
| üí¨ –¢–µ–∫—Å—Ç–æ–≤—ã–π —á–∞—Ç      | `pro` / `flash` |    ‚úÖ `/1model` `/2model`    |
| üé§ –ì–æ–ª–æ—Å              | `flash`         |              ‚ùå              |
| üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ | `pro` / `flash` | ‚úÖ `/imagepro` `/imageflash` |
| ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ     | `pro` / `flash` |              ‚úÖ              |
| üåê –ü–µ—Ä–µ–≤–æ–¥            | `flash`         |              ‚ùå              |
| üì∫ YouTube            | `flash`         |              ‚ùå              |
| üîç –ò–Ω–ª–∞–π–Ω             | `flash` + –ø–æ–∏—Å–∫ |              ‚ùå              |

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã (–ü—Ä–µ—Ñ–∏–∫—Å—ã)

| –ü—Ä–µ—Ñ–∏–∫—Å               | –î–µ–π—Å—Ç–≤–∏–µ                      | –ö–æ–¥ (—Å—Ç—Ä–æ–∫–∞) |
|:----------------------|:------------------------------|:------------:|
| `–ø` / `–ø—Ä–æ` / `pro`   | üíé –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ Gemini Pro  |     2157     |
| `—Ñ`                   | ‚ö° –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ Gemini Flash |     2163     |
| `–∫` / `–∫–∞—Ä—Ç–∏–Ω–∫–∞`      | üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è      |     2182     |
| `–∫ –ø—Ä–æ`               | üíé –ú–æ–¥–µ–ª—å –∫–∞—Ä—Ç–∏–Ω–æ–∫ ‚Üí Pro      |     2193     |
| `–∫ —Ñ–ª–µ—à`              | ‚ö° –ú–æ–¥–µ–ª—å –∫–∞—Ä—Ç–∏–Ω–æ–∫ ‚Üí Flash     |     2203     |
| `–ø—Ä` / `–ø–µ—Ä–µ–≤–æ–¥`      | üåê –†–µ–∂–∏–º –ø–µ—Ä–µ–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞/—Ñ–æ—Ç–æ |     2063     |
| `—Ä` / `—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å` | ‚úèÔ∏è –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ  |     2224     |
| `—é` / `—é—Ç—É–±`          | üì∫ –†–µ–∂–∏–º YouTube —Å–∞–º–º–∞—Ä–∏      |     2104     |
| `.`                   | üßπ –°–±—Ä–æ—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞            |     2170     |
| `–≤—ã—Ö–æ–¥` / `exit`      | ‚èπÔ∏è –í—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞            |     2032     |

---

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è            | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è? | –û–ø–∏—Å–∞–Ω–∏–µ                      |
|:----------------------|:-------------:|:------------------------------|
| `TELEGRAM_TOKEN`      |       ‚úÖ       | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather      |
| `GEMINI_API_KEY`      |       ‚úÖ       | –ö–ª—é—á Gemini API               |
| `ADMIN_ID`            |       ‚ùå       | Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞    |
| `ALLOWED_USERS`       |       ‚ùå       | –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é |
| `LOG_TO_FILE`         |       ‚ùå       | `1`/`0` ‚Äî –∑–∞–ø–∏—Å—å –≤ `bot.log`  |
| `SAVE_ACTIVITY_LOG`   |       ‚ùå       | `1`/`0` ‚Äî –ª–æ–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏      |
| `LOG_RETENTION_DAYS`  |       ‚ùå       | –•—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ N –¥–Ω–µ–π           |
| `LOG_MAX_TOTAL_BYTES` |       ‚ùå       | –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ –ª–æ–≥–æ–≤           |

---

## üì° Callback –∫–Ω–æ–ø–æ–∫

| `callback_data` | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ              |
|:----------------|:------------------------|
| `photo_analyze` | üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ   |
| `photo_edit`    | ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ   |
| `album_edit`    | ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–ª—å–±–æ–º |

---

## üîÑ –†–µ–∂–∏–º—ã (`context.user_data`)

| –ö–ª—é—á            | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                              |
|:----------------|:--------|:--------------------------------------|
| `model`         | `str`   | –¢–µ–∫—Å—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å: `'pro'` / `'flash'` |
| `image_model`   | `str`   | –ú–æ–¥–µ–ª—å –∫–∞—Ä—Ç–∏–Ω–æ–∫: `'pro'` / `'flash'`  |
| `mode`          | `str`   | –ê–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º (—Å–º. –Ω–∏–∂–µ)             |
| `chat_session`  | `Chat`  | –°–µ—Å—Å–∏—è —á–∞—Ç–∞ Gemini                    |
| `last_activity` | `float` | Timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏        |
| `photo_task`    | `dict`  | –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –¥–ª—è –∫–Ω–æ–ø–æ–∫                |
| `active_image`  | `dict`  | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ               |

### –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `mode`:

| –†–µ–∂–∏–º                  | –û–ø–∏—Å–∞–Ω–∏–µ                         |
|:-----------------------|:---------------------------------|
| `translate`            | –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞/—Ñ–æ—Ç–æ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ (—Ñ–æ—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å –∑–∞–º–µ–Ω–µ–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º) |
| `youtube_mode`         | –û–∂–∏–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ YouTube          |
| `image_gen`            | –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–º—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏    |
| `awaiting_edit_prompt` | –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–º—Ç–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è   |
| `awaiting_edit_photo`  | –û–∂–∏–¥–∞–Ω–∏–µ —Ñ–æ—Ç–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ –°—Å—ã–ª–∫–∏

- [Gemini API Docs](https://ai.google.dev/gemini-api/docs)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Python-Telegram-Bot](https://python-telegram-bot.readthedocs.io/)

